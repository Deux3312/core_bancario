<!DOCTYPE html>
<html lang="en">

<head>
    <title>Celaque</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,
            user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="keywords" content="">
    <meta name="author" content="Phoenixcoded" />
    <!-- Favicon icon -->
    <link rel="icon" href="../../plugins/images/favicon.ico" type="image/x-icon">

    <!-- prism css -->
    <link rel="stylesheet" href="../../plugins/css/plugins/prism-coy.css">
    <!-- vendor css -->
    <link rel="stylesheet" href="../../plugins/css/style.css">
    <!--Swal-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!--Swal 2-->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../../plugins/css/bootstrap.css">
    <link rel="stylesheet" href="../../plugins/css/dataTables.bootstrap4.min.css">

</head>
<style>
     ::-webkit-scrollbar {
        display: none;
    }
</style>

<body>
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <div class="content-wrapper pb-0">
        <div class="pcoded-wrapper container">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <div class="main-body">
                        <div class="page-wrapper">
                            <div class="page-header">
                                <div class="page-block">
                                    <div class="row align-items-center">
                                        <div class="col-md-12">
                                            <div class="page-header-title">
                                                <CENTER>
                                                    <h2 class="m-b-10">Creación de Tasa de Cambio</h2>
                                                </CENTER>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>


                            <button type="button" class="btn btn-primary
                                    me-2 abc1" style="float:right" data-toggle="modal" id="Creacion_Tasa">Crear
                                    Tasa de Cambio</button>


                            <table id="example" class="table table-striped
                                    table-bordered" style="width:100%">

                                <thead>
                                    <tr>
                                        <th>Editar</th>
                                        <th>Tipo Prestamo</th>
                                        <th>%tasa</th>
                                        <th>fecha inicio</th>
                                        <th>fecha final</th>
                                    </tr>
                                </thead>
                                <tbody>


                                </tbody>

                            </table>
                            <!--Modal de creacion de Tasa -->
                            <div class="modal fade" id="CreacionTasa" tabindex="-1" role="dialog" aria-labelledby="CreacionTasaLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <CENTER>
                                                <h5 class="modal-title" id="CreacionTasaLabel">Creación de Tasa
                                                </h5>
                                            </CENTER>
                                            <button type="button" class="close" onclick="cerrar_modal();" aria-label="Close"><span
                                                        aria-hidden="true">&times;</span></button>
                                        </div>
                                        <div class="modal-body">
                                            <form>
                                                <div class="form-group" id="tipo_prestamo_div">
                                                    <label for="exampleFormControlSelect1">Tipo Prestamo</label>
                                                    <select class="form-control" id="tipo_prestamo">
                                                            <option value="">SELECCIONE</option>
                                                            <option value="PERSONAL">PERSONAL</option>
                                                            <option value="HIPOTECARIO">HIPOTECARIO</option>
                                                            <option value="AGRICOLA">AGRICOLA</option>
                                                            <option value="MICROCREDITO">MICROCREDITO</option>
                                                        </select>
                                                </div>
                                                <div class="form-group" id="tasa_div">
                                                    <label for="recipient-name" class="col-form-label">Tasa en %:</label>
                                                    <input type="number" class="form-control" id="tasa">
                                                </div>
                                                <div class="form-group" id="fecha_inicio_div">
                                                    <label for="recipient-name" class="col-form-label">Fecha Inicial Tasa:</label>
                                                    <input type="date" class="form-control" id="fecha_inicio">
                                                </div>
                                                <div class="form-group" id="fecha_fin_div">
                                                    <label for="recipient-name" class="col-form-label">Fecha Final Tasa:</label>
                                                    <input type="date" class="form-control" id="fecha_fin">
                                                </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn
                                                    btn-secondary" onclick="cerrar_modal();">Cancelar</button>
                                            <button type="button" class="btn
                                                    btn-primary" id="crear_tasa">Guardar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Modal de edicion de Tasa -->
                            <div class="modal fade" id="EdicionTasa" tabindex="-1" role="dialog" aria-labelledby="EdicionTasaLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <CENTER>
                                                <h5 class="modal-title" id="EdicionTasaLabel">Edición de Tasa
                                                </h5>
                                            </CENTER>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                        aria-hidden="true">&times;</span></button>
                                        </div>
                                        <div class="modal-body">
                                            <form>
                                                <div class="form-group" id="tipo_prestamo_edicion_div">
                                                    <input type="hidden" class="form-control" id="id_registro_edicion">
                                                    <label for="exampleFormControlSelect1">Tipo Prestamo</label>
                                                    <select class="form-control" id="tipo_prestamo_edicion">
                                                            <option value="">SELECCIONE</option>
                                                            <option value="PERSONAL">PERSONAL</option>
                                                            <option value="HIPOTECARIO">HIPOTECARIO</option>
                                                            <option value="AGRICOLA">AGRICOLA</option>
                                                            <option value="MICROCREDITO">MICROCREDITO</option>
                                                        </select>
                                                </div>
                                                <div class="form-group" id="tasa_edicion_div">
                                                    <label for="recipient-name" class="col-form-label">Tasa en %:</label>
                                                    <input type="number" class="form-control" id="tasa_edicion">
                                                </div>
                                                <div class="form-group" id="fecha_inicio_edicion_div">
                                                    <label for="recipient-name" class="col-form-label">Fecha Inicial Tasa:</label>
                                                    <input type="date" class="form-control" id="fecha_inicio_edicion">
                                                </div>
                                                <div class="form-group" id="fecha_fin_edicion_div">
                                                    <label for="recipient-name" class="col-form-label">Fecha Final Tasa:</label>
                                                    <input type="date" class="form-control" id="fecha_fin_edicion">
                                                </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn
                                                    btn-secondary" data-dismiss="modal">Cancelar</button>
                                            <button type="button" class="btn
                                                    btn-primary" id="guardar_tasa">Guardar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Required Js -->
    <script src="../../plugins/js/vendor-all.min.js"></script>
    <script src="../../plugins/js/plugins/bootstrap.min.js"></script>
    <script src="../../plugins/js/pcoded.min.js"></script>
    <!--Tablas-->
    <script src="../../plugins/js/jquery.dataTables.min.js"></script>
    <script src="../../plugins/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $.ajax({
                    type: "POST",
                    url: "../../model/model_seguridad/data_tasa.php",
                    dataType: "json",
                    data: {}
                })
                .done(function(data) {
                    //Realizando el Datatable y dandole formato a la data que obtenemos del JSON
                    $('#example').DataTable({
                        data: data,
                        columns: [{
                            data: 'id'
                        }, {
                            data: 'tipo_prestamo'
                        }, {
                            data: 'tasa'
                        }, {
                            data: 'fecha_inicio'
                        }, {
                            data: 'fecha_fin'
                        }]
                    });
                })
                .fail(function(data) {
                    Swal.fire(
                        'Error!',
                        'Ha ocurrido un error al cargar Tasa',
                        'error'
                    )
                });

        });

        function editar_tasa(identificador, tipo_prestamo, tasa, f_ini, f_fin) {
            $("#id_registro_edicion").val(identificador);
            $("#tipo_prestamo_edicion").val(tipo_prestamo);
            $("#tasa_edicion").val(tasa);
            $("#fecha_inicio_edicion").val(f_ini);
            $("#fecha_fin_edicion").val(f_fin);
            $("#EdicionTasa").modal("show");
        }
        //Boton para actualizar la data del departamento
        $("#guardar_tasa").click(function() {
            //Realizando las validaciones de los imputs
            var apr = 0;
            if ($("#tipo_prestamo_edicion").val() == null || $("#tipo_prestamo_edicion").val() == "") {
                apr = 0;
                $("#tipo_prestamo_edicion_div").addClass("alert alert-danger");
                return;
            } else {
                $("#tipo_prestamo_edicion_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#tasa_edicion").val() == null || $("#tasa_edicion").val() == "") {
                apr = 0;
                $("#tasa_edicion_div").addClass("alert alert-danger");
                return;
            } else {
                $("#tasa_edicion_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#fecha_inicio_edicion").val() == null || $("#fecha_inicio_edicion").val() == "") {
                apr = 0;
                $("#fecha_inicio_edicion_div").addClass("alert alert-danger");
                return;
            } else {
                $("#fecha_inicio_edicion_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#fecha_fin_edicion").val() == null || $("#fecha_fin_edicion").val() == "") {
                apr = 0;
                $("#fecha_fin_edicion_div").addClass("alert alert-danger");
                return;
            } else {
                $("#fecha_fin_edicion_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if (apr == 1) {
                //validaciones para los campos de fecha que no sean inferiores
                var today = new Date();
                var fechaInicio = new Date($("#fecha_inicio_edicion").val());
                var fechaFin = new Date($("#fecha_fin_edicion").val());
                if (fechaInicio < today) {
                    Swal.fire(
                        'Error!',
                        'La fecha de inicio debe ser mayor que hoy.',
                        'error'
                    );
                    $("#fecha_inicio_edicion_div").addClass("alert alert-danger");
                    return;
                } else {
                    $("#fecha_inicio_edicion_div").removeClass("alert alert-danger");
                }
                if (fechaFin <= fechaInicio) {
                    Swal.fire(
                        'Error!',
                        'La fecha de fin debe ser mayor que la fecha de inicio.',
                        'error'
                    );
                    $("#fecha_fin_edicion_div").addClass("alert alert-danger");
                    return;
                } else {
                    $("#fecha_fin_edicion_div").removeClass("alert alert-danger");
                }
                $.ajax({
                        type: "POST",
                        url: "../../model/model_seguridad/edt_tasa.php",
                        dataType: "json",
                        data: {
                            tipo_prestamo: $("#tipo_prestamo_edicion").val(),
                            tasa: $("#tasa_edicion").val(),
                            fecha_inicio: $("#fecha_inicio_edicion").val(),
                            fecha_fin: $("#fecha_fin_edicion").val(),
                            id: $("#id_registro_edicion").val()
                        }
                    })
                    .done(function(data) {
                        Swal.fire({
                                icon: 'success',
                                title: 'Éxito! <br> Tasa Actualizado exitosamente',
                                showConfirmButton: false,
                                timer: 2000
                            })
                            //Realizando la limpieza de todos los campos que se han llenado manualmente
                        setTimeout(function() {
                            location.reload();
                        }, 2000);
                    })
                    .fail(function(data) {
                        Swal.fire(
                            'Error!',
                            'Ha ocurrido un error al actualizar la tasa',
                            'error'
                        )
                    });
            }
        });
        //Boton para crear el departamento nuevo
        $("#crear_tasa").click(function() {
            //Realizando las validaciones de los imputs
            var apr = 0;
            if ($("#tipo_prestamo").val() == null || $("#tipo_prestamo").val() == "") {
                apr = 0;
                $("#tipo_prestamo_div").addClass("alert alert-danger");
                return;
            } else {
                $("#tipo_prestamo_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#tasa").val() == null || $("#tasa").val() == "") {
                apr = 0;
                $("#tasa_div").addClass("alert alert-danger");
                return;
            } else {
                $("#tasa_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#fecha_inicio").val() == null || $("#fecha_inicio").val() == "") {
                apr = 0;
                $("#fecha_inicio_div").addClass("alert alert-danger");
                return;
            } else {
                $("#fecha_inicio_div").removeClass("alert alert-danger")
                apr = 1;
            }
            if ($("#fecha_fin").val() == null || $("#fecha_fin").val() == "") {
                apr = 0;
                $("#fecha_fin_div").addClass("alert alert-danger");
                return;
            } else {
                $("#fecha_fin_div").removeClass("alert alert-danger")
                apr = 1;
            }

            if (apr == 1) {
                //validaciones para los campos de fecha que no sean inferiores
                var today = new Date();
                var fechaInicio = new Date($("#fecha_inicio").val());
                var fechaFin = new Date($("#fecha_fin").val());
                if (fechaInicio < today) {
                    Swal.fire(
                        'Error!',
                        'La fecha de inicio debe ser mayor que hoy.',
                        'error'
                    );
                    $("#fecha_inicio_div").addClass("alert alert-danger");
                    return;
                } else {
                    $("#fecha_inicio_div").removeClass("alert alert-danger");
                }
                if (fechaFin <= fechaInicio) {
                    Swal.fire(
                        'Error!',
                        'La fecha de fin debe ser mayor que la fecha de inicio.',
                        'error'
                    );
                    $("#fecha_fin_div").addClass("alert alert-danger");
                    return;
                } else {
                    $("#fecha_fin_div").removeClass("alert alert-danger");
                }
                $.ajax({
                        type: "POST",
                        url: "../../model/model_seguridad/insrt_tasa.php",
                        dataType: "json",
                        data: {
                            tipo_prestamo: $("#tipo_prestamo").val(),
                            tasa: $("#tasa").val(),
                            fecha_inicio: $("#fecha_inicio").val(),
                            fecha_fin: $("#fecha_fin").val()
                        }
                    })
                    .done(function(data) {
                        if (data == 1) {
                            Swal.fire({
                                    icon: 'success',
                                    title: 'Éxito! <br> Tasa Creada exitosamente',
                                    showConfirmButton: false,
                                    timer: 2000
                                })
                                //Realizando la limpieza de todos los campos que se han llenado manualmente
                            setTimeout(function() {
                                location.reload();
                            }, 2000);
                        } else {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Advertencia! <br> Tipo de Prestamo ya existe en Base de Datos',
                                showConfirmButton: false,
                                timer: 2000
                            })
                            return;
                        }
                    })
                    .fail(function(data) {
                        Swal.fire(
                            'Error!',
                            'Ha ocurrido un error al insertar Tasa',
                            'error'
                        )
                    });
            }
        });
        //Desplegando el MOdal para la creacion de DEpartamentos
        $("#Creacion_Tasa").click(function() {
            //Realizando el despliegue del modal.
            $("#CreacionTasa").modal("show");

        });
    </script>
    <!-- prism Js -->
    <script src="../../plugins/js/plugins/prism.js"></script>
    <script src="../../plugins/js/horizontal-menu.js"></script>
    <script>
        (function() {
            if ($('#layout-sidenav').hasClass('sidenav-horizontal')) {
                return;
            }
            try {
                window.layoutHelpers._getSetting("Rtl")
                window.layoutHelpers.setCollapsed(
                    localStorage.getItem('layoutCollapsed') === 'true',
                    false
                );
            } catch (e) {}
        })();
        $(function() {
            $('#layout-sidenav').each(function() {
                new SideNav(this, {
                    orientation: $(this).hasClass('sidenav-horizontal') ? 'horizontal' : 'vertical'
                });
            });
            $('body').on('click', '.layout-sidenav-toggle', function(e) {
                e.preventDefault();
                window.layoutHelpers.toggleCollapsed();
                if (!window.layoutHelpers.isSmallScreen()) {
                    try {
                        localStorage.setItem('layoutCollapsed', String(window.layoutHelpers.isCollapsed()));
                    } catch (e) {}
                }
            });
        });
        $(document).ready(function() {
            $("#pcoded").pcodedmenu({
                themelayout: 'horizontal',
                MenuTrigger: 'hover',
                SubMenuTrigger: 'hover',
            });
        });

        function cerrar_modal() {
            $("#departamento").val("");
            $("#descrip").val("");
            $("#empresa").val("");
            $("#estado").val("");
            $("#CreacionTasa").modal("hide");
        };
    </script>
    <script src="../../plugins/js/analytics.js"></script>
    <!--Librerias para Mask Money-->
    <script src="../../plugins/jquery-maskmoney-master/src/jquery.maskMoney.js" type="text/javascript"></script>
    <!--Fin Librerias MAsk MOney-->
    <!--Librerias para Select2-->
    <link href="../../plugins/select2-develop/dist/css/select2.min.css" rel="stylesheet" />
    <script src="../../plugins/select2-develop/dist/js/select2.min.js"></script>
    <!--Fin Librerias para Select2-->
</body>

</html>